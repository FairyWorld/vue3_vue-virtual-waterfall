"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue");function j(e){return o.getCurrentScope()?(o.onScopeDispose(e),!0):!1}function S(e){return typeof e=="function"?e():o.unref(e)}const X=typeof window!="undefined",O=()=>{};function V(e,r){function n(...t){return new Promise((l,p)=>{Promise.resolve(e(()=>r.apply(this,t),{fn:r,thisArg:this,args:t})).then(l).catch(p)})}return n}function q(e,r={}){let n,t,l=O;const p=s=>{clearTimeout(s),l(),l=O};return s=>{const c=S(e),f=S(r.maxWait);return n&&p(n),c<=0||f!==void 0&&f<=0?(t&&(p(t),t=null),Promise.resolve(s())):new Promise((i,m)=>{l=r.rejectOnCancel?m:i,f&&!t&&(t=setTimeout(()=>{n&&p(n),t=null,i(s())},f)),n=setTimeout(()=>{t&&p(t),t=null,i(s())},c)})}}function G(e,r=!0,n=!0,t=!1){let l=0,p,a=!0,s=O,c;const f=()=>{p&&(clearTimeout(p),p=void 0,s(),s=O)};return m=>{const d=S(e),v=Date.now()-l,w=()=>c=m();return f(),d<=0?(l=Date.now(),w()):(v>d&&(n||!a)?(l=Date.now(),w()):r&&(c=new Promise((h,g)=>{s=t?g:h,p=setTimeout(()=>{l=Date.now(),a=!0,h(w()),f()},Math.max(0,d-v))})),!n&&!p&&(p=setTimeout(()=>a=!0,d)),a=!1,c)}}function L(e,r=200,n={}){return V(q(r,n),e)}function H(e,r=200,n={}){const t=o.ref(e.value),l=L(()=>{t.value=e.value},r,n);return o.watch(e,()=>l()),t}function U(e,r=200,n=!1,t=!0,l=!1){return V(G(r,n,t,l),e)}function Y(e,r=!0){o.getCurrentInstance()?o.onMounted(e):r?e():o.nextTick(e)}function T(e){var r;const n=S(e);return(r=n==null?void 0:n.$el)!=null?r:n}const $=X?window:void 0;function R(...e){let r,n,t,l;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,t,l]=e,r=$):[r,n,t,l]=e,!r)return O;Array.isArray(n)||(n=[n]),Array.isArray(t)||(t=[t]);const p=[],a=()=>{p.forEach(i=>i()),p.length=0},s=(i,m,d,v)=>(i.addEventListener(m,d,v),()=>i.removeEventListener(m,d,v)),c=o.watch(()=>[T(r),S(l)],([i,m])=>{a(),i&&p.push(...n.flatMap(d=>t.map(v=>s(i,d,v,m))))},{immediate:!0,flush:"post"}),f=()=>{c(),a()};return j(f),f}function J(){const e=o.ref(!1);return o.getCurrentInstance()&&o.onMounted(()=>{e.value=!0}),e}function K(e){const r=J();return o.computed(()=>(r.value,!!e()))}var P=Object.getOwnPropertySymbols,Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable,ee=(e,r)=>{var n={};for(var t in e)Q.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&P)for(var t of P(e))r.indexOf(t)<0&&Z.call(e,t)&&(n[t]=e[t]);return n};function N(e,r,n={}){const t=n,{window:l=$}=t,p=ee(t,["window"]);let a;const s=K(()=>l&&"ResizeObserver"in l),c=()=>{a&&(a.disconnect(),a=void 0)},f=o.computed(()=>Array.isArray(e)?e.map(d=>T(d)):[T(e)]),i=o.watch(f,d=>{if(c(),s.value&&l){a=new ResizeObserver(r);for(const v of d)v&&a.observe(v,p)}},{immediate:!0,flush:"post",deep:!0}),m=()=>{c(),i()};return j(m),{isSupported:s,stop:m}}function te(e,r={}){const{reset:n=!0,windowResize:t=!0,windowScroll:l=!0,immediate:p=!0}=r,a=o.ref(0),s=o.ref(0),c=o.ref(0),f=o.ref(0),i=o.ref(0),m=o.ref(0),d=o.ref(0),v=o.ref(0);function w(){const h=T(e);if(!h){n&&(a.value=0,s.value=0,c.value=0,f.value=0,i.value=0,m.value=0,d.value=0,v.value=0);return}const g=h.getBoundingClientRect();a.value=g.height,s.value=g.bottom,c.value=g.left,f.value=g.right,i.value=g.top,m.value=g.width,d.value=g.x,v.value=g.y}return N(e,w),o.watch(()=>T(e),h=>!h&&w()),l&&R("scroll",w,{capture:!0,passive:!0}),t&&R("resize",w,{passive:!0}),Y(()=>{p&&w()}),{height:a,bottom:s,left:c,right:f,top:i,width:m,x:d,y:v,update:w}}function oe(e,r={width:0,height:0},n={}){const{window:t=$,box:l="content-box"}=n,p=o.computed(()=>{var c,f;return(f=(c=T(e))==null?void 0:c.namespaceURI)==null?void 0:f.includes("svg")}),a=o.ref(r.width),s=o.ref(r.height);return N(e,([c])=>{const f=l==="border-box"?c.borderBoxSize:l==="content-box"?c.contentBoxSize:c.devicePixelContentBoxSize;if(t&&p.value){const i=T(e);if(i){const m=t.getComputedStyle(i);a.value=Number.parseFloat(m.width),s.value=Number.parseFloat(m.height)}}else if(f){const i=Array.isArray(f)?f:[f];a.value=i.reduce((m,{inlineSize:d})=>m+d,0),s.value=i.reduce((m,{blockSize:d})=>m+d,0)}else a.value=c.contentRect.width,s.value=c.contentRect.height},n),o.watch(()=>T(e),c=>{a.value=c?r.width:0,s.value=c?r.height:0}),{width:a,height:s}}const F=1;function ne(e,r={}){const{throttle:n=0,idle:t=200,onStop:l=O,onScroll:p=O,offset:a={left:0,right:0,top:0,bottom:0},eventListenerOptions:s={capture:!1,passive:!0},behavior:c="auto"}=r,f=o.ref(0),i=o.ref(0),m=o.computed({get(){return f.value},set(u){v(u,void 0)}}),d=o.computed({get(){return i.value},set(u){v(void 0,u)}});function v(u,b){var A,C,E;const W=S(e);W&&((E=W instanceof Document?document.body:W)==null||E.scrollTo({top:(A=S(b))!=null?A:d.value,left:(C=S(u))!=null?C:m.value,behavior:S(c)}))}const w=o.ref(!1),h=o.reactive({left:!0,right:!1,top:!0,bottom:!1}),g=o.reactive({left:!1,right:!1,top:!1,bottom:!1}),D=u=>{w.value&&(w.value=!1,g.left=!1,g.right=!1,g.top=!1,g.bottom=!1,l(u))},y=L(D,n+t),_=u=>{const b=u===window?u.document.documentElement:u===document?u.documentElement:u,{display:A,flexDirection:C}=getComputedStyle(b),E=b.scrollLeft;g.left=E<f.value,g.right=E>f.value;const W=Math.abs(E)<=0+(a.left||0),z=Math.abs(E)+b.clientWidth>=b.scrollWidth-(a.right||0)-F;A==="flex"&&C==="row-reverse"?(h.left=z,h.right=W):(h.left=W,h.right=z),f.value=E;let M=b.scrollTop;u===document&&!M&&(M=document.body.scrollTop),g.top=M<i.value,g.bottom=M>i.value;const I=Math.abs(M)<=0+(a.top||0),k=Math.abs(M)+b.clientHeight>=b.scrollHeight-(a.bottom||0)-F;A==="flex"&&C==="column-reverse"?(h.top=k,h.bottom=I):(h.top=I,h.bottom=k),i.value=M},x=u=>{const b=u.target===document?u.target.documentElement:u.target;_(b),w.value=!0,y(u),p(u)};return R(e,"scroll",n?U(x,n,!0,!1):x,s),R(e,"scrollend",D,s),{x:m,y:d,isScrolling:w,arrivedState:h,directions:g,measure(){const u=S(e);u&&_(u)}}}const B=o.defineComponent({name:"VirtualWaterfall",__name:"virtual-waterfall",props:{key:{default:"id"},gap:{default:15},preloadScreenCount:{default:1},bottomDistance:{default:2e3},itemMinWidth:{default:240},loading:{type:Boolean,default:!1},items:{default:()=>[]},calcItemHeight:{type:Function,default:(e,r)=>0}},emits:["load-more"],setup(e,{expose:r,emit:n}){const t=e;o.useSlots();const l=o.ref(),{y:p}=ne(l),a=L(()=>{t.loading||s.value.offsetHeight-p.value-l.value.clientHeight<t.bottomDistance&&n("load-more")},100,{maxWait:500});o.onMounted(()=>{var y;(y=l.value)==null||y.addEventListener("scroll",a)});const s=o.ref(),{width:c}=oe(s),{top:f}=te(s),i=H(c,200,{maxWait:400}),m=H(f,200,{maxWait:400}),d=o.computed(()=>{if(!i.value)return 0;const y=i.value+t.gap*2;return y>=t.itemMinWidth*2?Math.ceil(y/t.itemMinWidth):2}),v=o.ref(new Array(d.value).fill(0)),w=o.computed(()=>!i.value||d.value<=0?0:(i.value-(d.value-1)*t.gap)/d.value),h=o.computed(()=>{if(!i.value)return[];v.value=new Array(d.value).fill(0);const y=t.items.length,_=[];for(let x=0;x<y;x++){const u=D(),b={item:t.items[x],column:u,top:v.value[u],left:(w.value+t.gap)*u,height:t.calcItemHeight(t.items[x],w.value)};v.value[u]+=t.calcItemHeight(t.items[x],w.value)+t.gap,_.push(b)}return _}),g=o.computed(()=>{const y=h.value.length;if(!y)return[];const _=-m.value-t.preloadScreenCount*window.innerHeight,x=-m.value+(t.preloadScreenCount+1)*window.innerHeight,u=[];for(let b=0;b<y;b++)h.value[b].top>_&&h.value[b].top<x&&u.push(h.value[b]);return u}),D=()=>v.value.indexOf(Math.min(...v.value));return r({backTop(){var y;(y=l.value)==null||y.scrollTo({top:0,behavior:"smooth"})}}),(y,_)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"container",ref:l,style:{width:"100%",height:"100%",overflow:"auto","scroll-behavior":"smooth"}},[o.createElementVNode("div",{ref_key:"content",ref:s,style:o.normalizeStyle({position:"relative",height:`${Math.max(...v.value)+t.gap}px`,padding:`${y.gap}px`,boxSizing:"border-box",width:"100%",willChange:"height"})},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(g.value,(x,u)=>{var b;return o.openBlock(),o.createElementBlock("div",{key:(b=x.item[y.key])!=null?b:u,style:o.normalizeStyle({position:"absolute",width:`${w.value}px`,height:`${x.height}px`,transform:`translate(${x.left}px, ${x.top}px)`,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",contentVisibility:"auto",containIntrinsicSize:`${x.height}px`})},[o.renderSlot(y.$slots,"default",{item:x.item,index:u})],4)}),128))],4)],512))}}),re=e=>{e.component(B.name,B)},le={install:re};exports.VirtualWaterfall=B;exports.default=le;
